<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="AuthGuard Documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="AuthGuard Documentation Blog Atom Feed"><title data-react-helmet="true">Tutorial 3: Social login with OpenID Connect | AuthGuard Documentation</title><meta data-react-helmet="true" property="og:title" content="Tutorial 3: Social login with OpenID Connect | AuthGuard Documentation"><meta data-react-helmet="true" name="description" content="Identity federation with AuthGuard and and OpenID Connect provider"><meta data-react-helmet="true" property="og:description" content="Identity federation with AuthGuard and and OpenID Connect provider"><meta data-react-helmet="true" property="og:url" content="https://authguard.github.io/blog/tutorial-oidc"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://authguard.github.io/blog/tutorial-oidc"><link data-react-helmet="true" rel="alternate" href="https://authguard.github.io/blog/tutorial-oidc" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://authguard.github.io/blog/tutorial-oidc" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.73b2fc11.css">
<link rel="preload" href="/assets/js/runtime~main.2ee894c7.js" as="script">
<link rel="preload" href="/assets/js/main.d64b0624.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/reduced_authguard_logo.png" alt="AuthGuard" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/reduced_authguard_logo.png" alt="AuthGuard" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">AuthGuard</strong></a><a class="navbar__item navbar__link" href="/docs/intro">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/api">API</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/authguard/AuthGuard" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/reduced_authguard_logo.png" alt="AuthGuard" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/reduced_authguard_logo.png" alt="AuthGuard" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">AuthGuard</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Docs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/api">API</a></li><li class="menu__list-item"><a href="https://github.com/authguard/AuthGuard" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/tutorial-email-sms">Tutorial 4: Sending emails and text messages</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/tutorial-oidc">Tutorial 3: Social login with OpenID Connect</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/tutorial-ldap">Tutorial 2: Federation with LDAP</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/tutorial-basic-example">Tutorial 1: Basic example</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="margin-bottom--sm blogPostTitle_GeHD">Tutorial 3: Social login with OpenID Connect</h1><div class="margin-vert--md"><time datetime="2021-12-03T00:00:00.000Z" class="blogPostDate_fNvV">December 3, 2021 Â· 4 min read</time></div><div class="avatar margin-vert--md"><div class="avatar__intro"></div></div></header><div class="markdown"><p>In a previous tutorial we showed how AuthGuard can be used
alongside an LDAP server for identity federation. In this
example, we will achieve something similar but with an OpenID
Connect instead.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Also applies to any OAuth 2.0 provider</h5></div><div class="admonition-content"><p>In this tutorial we will focus on OpenID Connect providers
but the same steps still apply to a regular OAuth 2.0 providers.
The only difference will be the inclusion of an ID token.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><ol><li><p>A standard AuthGuard distribution or a custom distribution
with the JWT extension.</p></li><li><p>Follow the guideline for the <a href="/docs/setup">server setup</a>.</p></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="openid-connect"></a>OpenID Connect<a class="hash-link" href="#openid-connect" title="Direct link to heading">#</a></h2><p>OpenID Connect is, in summary, an addition to regular OAuth 2.0
where the identity provider also provies and ID token which
carries information about the user. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="scenario"></a>Scenario<a class="hash-link" href="#scenario" title="Direct link to heading">#</a></h2><p>Our scenario will follow a regular Authorization Code flow and
it goes as follows:</p><ol><li>Your client will make a request to AuthGuard to generate an
authorization URL for a specific provider.</li><li>Your application should follow the redirect and take the user
to the authorization page of the identity provider. </li><li>Once the user approves the authentication, they will be
redirected back to your application or website.</li><li>Ask AuthGuard to verify the state and exchange the authorization
code with access and (optionally) ID tokens.</li><li>AuthGuard will perform those actions and will return the
tokens generated by the provider, as well as the account ID
of the corresponding AuthGuard account if configured to do
so.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="test-setup"></a>Test Setup<a class="hash-link" href="#test-setup" title="Direct link to heading">#</a></h2><p>For this tutorial you will need to set up an OAuth client with
an identity provider. For example, Google.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="authguard-configuration"></a>AuthGuard Configuration<a class="hash-link" href="#authguard-configuration" title="Direct link to heading">#</a></h2><p>There are no special exchanges which need to be allowed in order
for this to work. The only needed configuration is to add the
providers. You can add as many as you want, as long as they unique
provider names. For example, the configuration for Google OAuth
will look something like this</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">oauth</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">clients</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">provider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> google</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">clientId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &lt;your client ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">clientSecret</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &lt;you client secret</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">defaultScopes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;openid&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;profile&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;email&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">authUrl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//accounts.google.com/o/oauth2/v2/auth</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">tokenUrl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//oauth2.googleapis.com/token</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">authRedirectUrl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &lt;your authorization redirect URL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">tokenRedirectUrl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &lt;your token redirect URL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">accountProvider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">emailField</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> email</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Two things to note here:</p><ol><li>The default scopes may differ from provider to the next. Make
sure that you know which scopes to use. For an OIDC-compliant
provider, &quot;openid&quot; and &quot;profile&quot; scopes will be there. We added
&quot;email&quot; scope since we will be used the user&#x27;s email.</li><li>If you want AuthGuard to create local accounts for users, then
you can set &quot;accountProvider&quot; to true, and then specify which
field in the ID token should be used as an email.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="social-login"></a>Social Login<a class="hash-link" href="#social-login" title="Direct link to heading">#</a></h2><p>The social login process is broken into two steps: obtaining an
authorization URL, then exchanging the authorization code returned
by the identity server with usable tokens. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="authorization-url"></a>Authorization URL<a class="hash-link" href="#authorization-url" title="Direct link to heading">#</a></h3><p>Obtaining an authorization URL can simply done by making a GET request
to <code>/oauth/auth_url?provider=&lt;provider&gt;</code>. AuthGuard will return
back an HTTP response of 302 and the &quot;Location&quot; header will have
the URL for that provider. Behind the scenes, AuthGuard will generate
a session and use its token as the state (nonce) token.</p><p>After redirecting the user to that login page, they will be
asked to approve the authorization or not. If it was successful
then the identity server will redirect them back to your application
with a state, an athorization code.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="exchange-the-authorization-code"></a>Exchange the Authorization Code<a class="hash-link" href="#exchange-the-authorization-code" title="Direct link to heading">#</a></h3><p>Now that you have an authorization code and a state token, you can
call AuthGuard to perform the exchange and get access, refresh, and
potentially ID tokens from the identity server. To do so, send a POST
request to <code>/oauth/authorize?provider=&lt;provider&gt;&amp;state=&lt;returned state&gt;&amp;code=&lt;returned code&gt;</code>.</p><p>If the provider is also configured as an account provider then
AuthGuard will create a social account for each unique user. The
subject of the ID will be used as an external ID to link the two.
If an account already exists, then AuthGuard will just retrieve
the existing user.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/tutorial">tutorial</a></div></footer></article><div><a href="https://github.com/facebook/docusaurus/edit/master/website/blog/blog/2021-12-03-oidc-federation.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/tutorial-email-sms"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« Tutorial 4: Sending emails and text messages</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/tutorial-ldap"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Tutorial 2: Federation with LDAP Â»</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a></li><li><a href="#openid-connect" class="table-of-contents__link">OpenID Connect</a></li><li><a href="#scenario" class="table-of-contents__link">Scenario</a></li><li><a href="#test-setup" class="table-of-contents__link">Test Setup</a></li><li><a href="#authguard-configuration" class="table-of-contents__link">AuthGuard Configuration</a></li><li><a href="#social-login" class="table-of-contents__link">Social Login</a><ul><li><a href="#authorization-url" class="table-of-contents__link">Authorization URL</a></li><li><a href="#exchange-the-authorization-code" class="table-of-contents__link">Exchange the Authorization Code</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Links</h4><ul class="footer__items"><li class="footer__item"><a href="https://nexblocks.com/nexblocks" target="_blank" rel="noopener noreferrer" class="footer__link-item">nex::blocks</a></li><li class="footer__item"><a href="https://nexblocks.com/nexblocks/portal" target="_blank" rel="noopener noreferrer" class="footer__link-item">Licenses</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 nex::blocks. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.2ee894c7.js"></script>
<script src="/assets/js/main.d64b0624.js"></script>
</body>
</html>