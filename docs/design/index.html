<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="AuthGuard Documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="AuthGuard Documentation Blog Atom Feed"><title data-react-helmet="true">Design | AuthGuard Documentation</title><meta data-react-helmet="true" property="og:url" content="https://authguard.github.io/docs/design"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Design | AuthGuard Documentation"><meta data-react-helmet="true" name="description" content="It is important to understand the fundmental parts of AuthGuard&#x27;s design to be able to configure and extend it correctly. This document will go through the internal parts without talking about the exposed API."><meta data-react-helmet="true" property="og:description" content="It is important to understand the fundmental parts of AuthGuard&#x27;s design to be able to configure and extend it correctly. This document will go through the internal parts without talking about the exposed API."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://authguard.github.io/docs/design"><link data-react-helmet="true" rel="alternate" href="https://authguard.github.io/docs/design" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://authguard.github.io/docs/design" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.73b2fc11.css">
<link rel="preload" href="/assets/js/runtime~main.08c9d7ea.js" as="script">
<link rel="preload" href="/assets/js/main.426ad8cc.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/reduced_authguard_logo.png" alt="AuthGuard" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/reduced_authguard_logo.png" alt="AuthGuard" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">AuthGuard</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/api">API</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/authguard/AuthGuard" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/reduced_authguard_logo.png" alt="AuthGuard" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/reduced_authguard_logo.png" alt="AuthGuard" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">AuthGuard</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/intro">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/api">API</a></li><li class="menu__list-item"><a href="https://github.com/authguard/AuthGuard" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro">AuthGuard</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/features">Features</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/run">Running AuthGuard</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/configuration">Configuration</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docs/design">Design</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Extensions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extend/extend">Extending AuthGuard</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extend/exchange">Exchange Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extend/dal">Data Access Layer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extend/messaging">Event Subscribers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extend/bootstrap">Bootstrap Steps</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/deployment">Deployment</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/setup">Setup and Usage</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/auth_scenarios">Authentication Scenarios</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/adminstration">Server Administration</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/federation">Identity Federation</a></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Design</h1></header><div class="markdown"><p>It is important to understand the fundmental parts of AuthGuard&#x27;s design to be able to configure and extend it correctly. This document will go through the internal parts without talking about the exposed API.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-three-layers--1"></a>The Three Layers + 1<a class="hash-link" href="#the-three-layers--1" title="Direct link to heading">#</a></h2><p>AuthGuard is implemented in three layers: API layer, service layer, and data access
layer, with an extra messaging layer parallel to the service layer.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="api-layer"></a>API Layer<a class="hash-link" href="#api-layer" title="Direct link to heading">#</a></h3><p>The outer most layer which exposes a REST API built using Javalin. Refer to the API
documentation to the available endpoints and payloads</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="service-layer"></a>Service Layer<a class="hash-link" href="#service-layer" title="Direct link to heading">#</a></h3><p>This is where the internal logic resides.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="data-access-layer"></a>Data Access Layer<a class="hash-link" href="#data-access-layer" title="Direct link to heading">#</a></h3><p>The layer which connects AuthGuard to data stores.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="messaging"></a>Messaging<a class="hash-link" href="#messaging" title="Direct link to heading">#</a></h3><p>The messaging layer does not interact directly with any other layer. It resides
parallel to the service layer and the two are connected through a message bus.
Some parts othe service layer push events to specific channels and you can add
components which subscribe to those channels and perform some other actions.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="data-models"></a>Data Models<a class="hash-link" href="#data-models" title="Direct link to heading">#</a></h2><p>Since AuthGuard integrates with external components at two layers: API and data
access, we opted for separating our models into three, each corresponding to a
layer: Data Transfer Objects (DTO) for API layer, Business Object (BO) for service
layer, and Data Object (DO) for data access layer.</p><p>Consumers of the API will deal with DTOs, data access implementations will deal with DOs, and event subscribers will deal BOs.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="low-level-exchange-service"></a>Low-Level Exchange Service<a class="hash-link" href="#low-level-exchange-service" title="Direct link to heading">#</a></h2><p>The exchange service is the core of AuthGuard authentication system. It provides a
flexible way of adding new forms of authentication with little effort. The exchange
service defines any authentication/authorization action as exchange of tokens, and
for the sake of simplicity everything is a token. So basic authorization header is
still treated as a token, and so are one-time passwords. And then any
authentication/authorization flow is defined as a sequence of exchanges. Here are a
couple of examples.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="login-session-example"></a>Login Session Example<a class="hash-link" href="#login-session-example" title="Direct link to heading">#</a></h3><p>Let&#x27;s say your login flow is just users provide username and password, and we give
them back a session token. We can the pre-defined exchange <code>basic</code> to <code>session</code>.
This exchange simply connects a basic authentication verifier with a session
provider.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="login-with-one-time-password"></a>Login with One-Time Password<a class="hash-link" href="#login-with-one-time-password" title="Direct link to heading">#</a></h3><p>If your flow is more complicated, let&#x27;s say user logins in, we send back an OTP,
then user provides the OTP, and we eventually send back an access token. This is
simply defined as two exchanges in AuthGuard:</p><ol><li><code>basic</code> to <code>otp</code></li><li><code>otp</code> to <code>access_token</code></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="high-level-authentication-steps"></a>High-Level Authentication Steps<a class="hash-link" href="#high-level-authentication-steps" title="Direct link to heading">#</a></h2><p>There are some endpoints provided which give you a shortcut to the exchange
service. Those endpoints are</p><ul><li><code>/authentication</code>: exchanges a basic token for whatever it is configured to
generate</li><li><code>/otp</code>: exchanges an OTP for whatever it is configured to generate</li><li><code>/passwordless</code>: exchanges a passwordless token for whatever it is configured to
generate</li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/design.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/configuration"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Configuration</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/extend/extend"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Extending AuthGuard Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-three-layers--1" class="table-of-contents__link">The Three Layers + 1</a><ul><li><a href="#api-layer" class="table-of-contents__link">API Layer</a></li><li><a href="#service-layer" class="table-of-contents__link">Service Layer</a></li><li><a href="#data-access-layer" class="table-of-contents__link">Data Access Layer</a></li><li><a href="#messaging" class="table-of-contents__link">Messaging</a></li></ul></li><li><a href="#data-models" class="table-of-contents__link">Data Models</a></li><li><a href="#low-level-exchange-service" class="table-of-contents__link">Low-Level Exchange Service</a><ul><li><a href="#login-session-example" class="table-of-contents__link">Login Session Example</a></li><li><a href="#login-with-one-time-password" class="table-of-contents__link">Login with One-Time Password</a></li></ul></li><li><a href="#high-level-authentication-steps" class="table-of-contents__link">High-Level Authentication Steps</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Links</h4><ul class="footer__items"><li class="footer__item"><a href="https://nexblocks.com/nexblocks" target="_blank" rel="noopener noreferrer" class="footer__link-item">nex::blocks</a></li><li class="footer__item"><a href="https://nexblocks.com/nexblocks/portal" target="_blank" rel="noopener noreferrer" class="footer__link-item">Licenses</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 nex::blocks. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.08c9d7ea.js"></script>
<script src="/assets/js/main.426ad8cc.js"></script>
</body>
</html>